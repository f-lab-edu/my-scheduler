name: my-scheduler-nextjs-action

on:
  push:
    branches: [fix/deploy]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"
      - name: Install & Build
        run: |
          npm ci
          npm run build

      - uses: actions/checkout@v4
        with:
          repository: davinahi/my-scheduler
          token: ${{ secrets.API_CLASSIC_TOKEN_GITHUB_NEXT }}
          path: personal

      # 동기화 -> 커밋 -> 푸시
      - name: Sync to personal repo & push
        run: |
          rsync -av --delete --exclude='.git' --exclude='.github' ./ personal/
          cd personal
          git config user.name "davinahi"

          git add .
          git commit -m "Deploy from org repo @${{ github.sha }}" || echo "No changes to commit"
          git push origin main
